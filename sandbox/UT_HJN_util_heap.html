<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>test</title>
<script>
HJN = {};
HJN.util = {};
</script>
<script src="../src/HJN.utils.js"></script>
</head>

<body>
<!-- ****1**** ****2**** ****3**** ****4**** ****5**** ****6**** ****7*****  -->
<nav><header style="color:blue;">UnitTest : HJN.util.heap</header></nav>

<section><div id="res"></div></section>

<script>
var div_res = document.getElementById("res");
var time = new Date();
var resTable = "";

function newTable(name){
    resTable += (resTable==="") ? time : "</table>"; 
    resTable += '<br><table rules="rows">'
        resTable +="<tr><th>" + name + "</th>" +
				"<th>" + "ret" + "</th>" +
				"<th>" + "validate(ret)" + "</th>" +
        		"<th>" + "heap" + "</th>" +
        		"<th>" + "correct" + "</th>" +
        		"<th>" + "validate(heap)" + "</th><tr>";
}

function test(func, retAns, heapAns){
	var ret = eval(func);
    var retRow = "<tr><td>" + func + "</td>" +
					"<td>" + ret + "</td>" +
    				"<td>" + (ret === retAns) + "</td>" +
    				"<td>[" + h._heap.toString() + "]</td>" + 
    				"<td>[" + heapAns + "]</td>" +
    				"<td>" + (h._heap.toString() === heapAns.toString()) + "</td><tr>";
    resTable += retRow;
    console.log(retRow);
    div_res.innerHTML = resTable + "</table>";
    return retRow
}

//　テスト
newTable("push pop");
var h = HJN.util.Heap();
test("h.push(5)", undefined, [5]);
test("h.push(2)", undefined, [2,5]);
test("h.push(3)", undefined, [2,5,3]);
test("h.push(1)", undefined, [1,2,3,5]);
test("h.push(4)", undefined, [1,2,3,5,4]);
test("h.pop()", 1, [2,4,3,5]);
test("h.pop()", 2, [3,4,5]);
test("h.pop()", 3, [4,5]);
test("h.pop()", 4, [5]);
test("h.pop()", 5, []);
test("h.pop()", undefined, []);

newTable("_delete");
var h = HJN.util.Heap();
test("h._del(0)", undefined, []);
test("h.push(2)", undefined, [2]);
test("h.push(5)", undefined, [2,5]);
test("h.push(1)", undefined, [1,5,2]);
test("h.push(4)", undefined, [1,4,2,5]);
test("h.push(3)", undefined, [1,3,2,5,4]);
test("h.push(0)", undefined, [0,3,1,5,4,2]);
test("h._del(6)", undefined, [0,3,1,5,4,2]);
test("h._del(0)", 0, [2,3,1,5,4]);
test("h._del(1)", 3, [2,4,1,5]);
test("h._del(3)", 5, [2,4,1]);
test("h.push(5)", undefined, [2,4,1,5]);
test("h._del(2)", 1, [2,4,5]);

newTable("del");
var h = HJN.util.Heap();
test("h.del('0')", undefined, []);
test("h.push('2')", undefined, [2]);
test("h.push('5')", undefined, [2,5]);
test("h.push('1')", undefined, [1,5,2]);
test("h.push('4')", undefined, [1,4,2,5]);
test("h.push('3')", undefined, [1,3,2,5,4]);
test("h.push('0')", undefined, [0,3,1,5,4,2]);
test("h.del('6')", undefined, [0,3,1,5,4,2]);
test("h.del('0')", 0, [2,3,1,5,4]);
test("h.del('1')", 3, [2,3,4,5]);
test("h.del('3')", 5, [2,5,4]);
test("h.push('5')", undefined, [2,5,4,5]);
test("h.del('5')", 5, [2,5,4]);


var A2S = function(a){
	    var ret ="";
	    a.forEach(function(e,i,a){ ret += e.val + ","; }, this);
	    return ret; 
    }; 
function test2(func, retAns, heapAns){
	var ret = eval(func);
    var retRow = "<tr><td>" + func + "</td>" +
					"<td>" + ret + "</td>" +
    				"<td>" + (ret === retAns) + "</td>" +
    				"<td>[" + A2S(h._heap)+ "]</td>" + 
    				"<td>[" + A2S(heapAns) + "]</td>" +
    				"<td>" + (A2S(h._heap) === A2S(heapAns)) + "</td><tr>";
    resTable += retRow;
    console.log(retRow);
    div_res.innerHTML = resTable + "</table>";
    return retRow
}
var app = function(v){return [v]};
var v = function(app){return {val:app[0], obj:app}};
var valFunc = function(o){return o ? o.val : undefined};
var delFunc = function(o){return o ? o.obj : undefined};
var h = HJN.util.Heap(valFunc, delFunc);
var a0 = app(0), v0 = v(a0);
var a1 = app(1), v1 = v(a1);
var a2 = app(2), v2 = v(a2);
var a3 = app(3), v3 = v(a3);
var a4 = app(4), v4 = v(a4);
var a5 = app(5), v5 = v(a5);
var a6 = app(6), v6 = v(a6);
newTable("delFunc");
test2("h.del(a0)", undefined, []);
test2("h.push(v2)", undefined, [v2]);
test2("h.push(v5)", undefined, [v2,v5]);
test2("h.push(v1)", undefined, [v1,v5,v2]);
test2("h.push(v4)", undefined, [v1,v4,v2,v5]);
test2("h.push(v3)", undefined, [v1,v3,v2,v5,v4]);
test2("h.push(v0)", undefined, [v0,v3,v1,v5,v4,v2]);
test2("h.del(a6)", undefined, [v0,v3,v1,v5,v4,v2]);
test2("h.del(a0)", 0, [v2,v3,v1,v5,v4]);
test2("h.del(a1)", 3, [v2,v3,v4,v5]);
test2("h.del(a3)", 5, [v2,v5,v4]);
test2("h.push(v5)", undefined, [v2,v5,v4,v5]);
test2("h.push(v6)", undefined, [v2,v5,v4,v5,v6]);
test2("h.del(a6)", 6, [v2,v5,v4,v5]);

</script>

<footer><small>&copy; copyright 2017 Junichiroh Hirose</small></footer>
</html>